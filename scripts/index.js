import{ItemStack as ar,MinecraftItemTypes as mr,system as lr}from"@minecraft/server";import{world as Ft}from"@minecraft/server";var S="-";import{ItemStack as Nt,MinecraftItemTypes as Mt}from"@minecraft/server";import{BlockLocation as Gn}from"@minecraft/server";var vt=32e3,ae="rubedo:database",M=new Gn(0,-64,0),Et=128;import{system as Bt,world as Rt}from"@minecraft/server";import{BlockLocation as Ue,MinecraftDimensionTypes as ee,system as St,world as te}from"@minecraft/server";import{MessageFormData as Un}from"@minecraft/server-ui";var Z=class{constructor(e,n){this.title=e,this.body=n,this.form=new Un,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var h={overworld:te.getDimension(ee.overworld),nether:te.getDimension(ee.nether),theEnd:te.getDimension(ee.theEnd),"minecraft:overworld":te.getDimension(ee.overworld),"minecraft:nether":te.getDimension(ee.nether),"minecraft:the_end":te.getDimension(ee.theEnd)};function le(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function ne(t){return new Date(t).toString()}function Tt(t){return new Ue(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function U(t,e,n,o=()=>{}){new Z("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}function Pt(t){return new Promise(e=>{let n=St.runSchedule(()=>{e(),St.clearRunSchedule(n)},t)})}function At(t,e){let n=[t.x,t.y,t.z],o=[t.x,t.y,t.z];return(t instanceof Ue||e instanceof Ue)&&(n=n.map(r=>Math.trunc(r)),o=o.map(r=>Math.trunc(r))),!n.find((r,i)=>o[i]!=r)}function Hn(t,e){let{x:n,y:o,z:r}=t,{x:i,y:s,z:m}=e,c=n<i?n:i,p=o<s?o:s,f=r<m?r:m,x=n<i?i:n,N=o<s?s:o,Ge=r<m?m:r;return[{x:c,y:p,z:f},{x,y:N,z:Ge}]}function Se(t,e,n){let[{x:o,y:r,z:i},{x:s,y:m,z:c}]=Hn(e,n),{x:p,y:f,z:x}=t;return p>=o&&p<=s&&f>=r&&f<=m&&x>=i&&x<=c}function xt(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}var H={},Te=!1;Bt.run(async()=>{try{await h.overworld.runCommandAsync("testfor @a"),Te=!0;for(let[t,e]of Object.entries(H))e(),delete H[t]}catch{let e=Rt.events.entityCreate.subscribe(n=>{Bt.run(()=>{Te=!0;for(let[o,r]of Object.entries(H))r(),delete H[o];Rt.events.entityCreate.unsubscribe(e)})})}});var k=class{static async awaitLoad(){if(!Te)return new Promise(e=>{k.subscribe(e)})}static subscribe(e){if(Te){e();return}let n=Object.keys(H).length;return H[n]=e,n}static unsubscribe(e){delete H[e]}};var b=class{constructor(e){this.tableName=e;this.tableName=e,this.MEMORY=null,this.QUEUE=[],k.subscribe(async()=>{await this.initData(),this.QUEUE.forEach(n=>n())})}static createTableEntity(e,n){let o=h.overworld.spawnEntity(ae,M);return o.setDynamicProperty("tableName",e),o.nameTag=`\xA7aDatabase Table: ${e}\xA7r`,n&&o.setDynamicProperty("index",n),o}static getTableEntities(e){return h.overworld.getEntitiesAtBlockLocation(M).filter(n=>n.typeId==ae&&n.getDynamicProperty("tableName")==e)}async addQueueTask(){return new Promise(e=>{this.QUEUE.push(e)})}async saveData(){this.MEMORY||await this.addQueueTask();let e=b.getTableEntities(this.tableName),n=xt(JSON.stringify(this.MEMORY),vt),o=Math.ceil(n.length/Et)-e.length;if(o>0)for(let r=0;r<o;r++)e.push(b.createTableEntity(this.tableName));for(let[r,i]of e.entries()){let s=i.getComponent("inventory").container;for(let[m,c]of n.entries()){if(!c)continue;if(m>s.size-1)break;let p=new Nt(Mt.acaciaBoat);p.nameTag=c,s.setItem(m,p),n[m]=null}for(let m=n.length+1;m<s.size;m++)s.setItem(m,new Nt(Mt.stick,0));if(i.setDynamicProperty("index",r),e[r]=null,!n.find(m=>m))break}e.filter(r=>r).forEach(r=>r.triggerEvent("despawn"))}async initData(){let e=b.getTableEntities(this.tableName).sort((r,i)=>r.getDynamicProperty("index")-i.getDynamicProperty("index")),n="";for(let r of e){let i=r.getComponent("inventory").container;for(let s=0;s<i.size;s++){let m=i.getItem(s);!m||(n=n+m.nameTag)}}let o=n==""?{}:JSON.parse(n);return this.MEMORY=o,o}async set(e,n){return this.MEMORY[e]=n,this.saveData()}get(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `getAsync` instead!");return this.MEMORY[e]}async getSync(e){return this.MEMORY?this.get(e):(await this.addQueueTask(),this.MEMORY[e])}keys(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `keysSync` instead!");return Object.keys(this.MEMORY)}async keysSync(){return this.MEMORY?this.keys():(await this.addQueueTask(),Object.keys(this.MEMORY))}values(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `valuesSync` instead!");return Object.values(this.MEMORY)}async valuesSync(){return this.MEMORY?this.values():(await this.addQueueTask(),Object.values(this.MEMORY))}has(e){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `hasSync` instead!");return Object.keys(this.MEMORY).includes(e)}async hasSync(e){return this.MEMORY?this.has(e):(await this.addQueueTask(),Object.keys(this.MEMORY).includes(e))}collection(){if(!this.MEMORY)throw new Error("Entities not loaded! Consider using `collectionSync` instead!");return this.MEMORY}async collectionSync(){return this.MEMORY?this.collection():(await this.addQueueTask(),this.MEMORY)}async delete(e){let n=delete this.MEMORY[e];return await this.saveData(),n}async clear(){return this.MEMORY={},await this.saveData()}};var a={config:new b("config"),freezes:new b("freezes"),mutes:new b("mutes"),bans:new b("bans"),regions:new b("regions"),roles:new b("roles"),tasks:new b("tasks"),npcs:new b("npcs"),ids:new b("ids"),logs:new b("logs"),gamemode:new b("gamemode"),protections:new b("protections")};import{world as qn}from"@minecraft/server";function Dt(t){return[...qn.getPlayers()].find(e=>e.name===t)}var z=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},ce=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},ue=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},He=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},q=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},de=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},qe=class{constructor(e="player"){this.name=e;this.typeName="Player";this.name=e}matches(e){return{success:!!Dt(e),value:Dt(e)}}fail(e){return`player: "${e}", is not in this world`}},We=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},pe=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Qe=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},Xe=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!a.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},g={string:ce,int:ue,float:He,location:q,boolean:de,player:qe,target:We,array:pe,duration:Qe,playerName:Xe};var Pe=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function Lt(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function Ot(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Je(t,e){t.tell({rawtext:[{text:e.data.invalidPermission?e.data.invalidPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function _t(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${S}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(s=>s.type instanceof z?s.type.name:s.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(s=>s.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function Wn([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],s=[r.x,r.y,r.z],m=[t,e,n].map(p=>{let f=parseFloat(p);return isNaN(f)?0:f}),c=[t,e,n].map((p,f)=>p.includes("~")?m[f]+i[f]:p.includes("^")?m[f]+s[f]:m[f]);return{x:c[0],y:c[1],z:c[2]}}function $t(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[s,m]of e.entries())if(!m.type.name.endsWith("*")){if(m.type instanceof q){i.push(Wn([t[s],t[s+1],t[s+2]],n.sender));continue}m.type instanceof z||i.push(m.type.matches(t[s]).value??t[s])}r.callback(new Pe(n),...i)}var W=[];Ft.events.beforeChat.subscribe(t=>{if(t.message.startsWith(S)){t.cancel=!0;let r=Lt(t.message,S),i=W.find(f=>f.depth==0&&(f.data.name==r[0]||f.data?.aliases?.includes(r[0]))),s={message:t.message,sendToTargets:t.sendToTargets,sender:t.sender,targets:t.targets};if(!i)return Ot(t.sender,r[0]);if(!i.data?.requires(t.sender))return Je(s.sender,i);r.shift();let m=[],c=(f,x)=>{if(f.children.length>0){let N=f.children.find(Ge=>Ge.type.matches(r[x]).success);return!N&&!r[x]&&f.callback?void 0:N?N.data?.requires(s.sender)?(m.push(N),c(N,x+1)):(Je(s.sender,N),"fail"):(_t(s.sender,i,f,r,x),"fail")}};if(c(i,0)=="fail")return;$t(r,m,s,i)}else{t.cancel=!0;var e=t.sender.name,n=a.roles.get(e)??"member",o="6";n=="admin"&&(o="a"),n=="member"&&(o="6"),n=="moderator"&&(o="c"),n=="builder"&&(o="b"),Ft.say({rawtext:[{text:`\xA7${o}\xA7l[${n.toUpperCase()}\xA7${o}\xA7l]\xA7r \xA73${e}\xA7c: \xA7f${t.message}\xA7r`}]})}});import{system as cn,world as so}from"@minecraft/server";var zt="rubedo:gui",fe="rubedo:inventory";import{world as O,Player as Xn,BlockLocation as Qt,MinecraftBlockTypes as Jn,GameMode as Zn,system as tt}from"@minecraft/server";import{BlockLocation as Kt,MinecraftBlockTypes as Qn}from"@minecraft/server";var Vt={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntities:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},jt=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Yt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var Q=[],Ae=!1,Ze=-64,et=320,y=class{static async getAllRegionsSync(){if(Ae)return Q;let e=(await a.regions.valuesSync()).map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{Q.push(n)}),Ae=!0,e}static getAllRegions(){if(Ae)return Q;let e=a.regions.values().map(n=>new y(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{Q.push(n)}),Ae=!0,e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&Se(e,{x:o.from.x,y:Ze,z:o.from.z},{x:o.to.x,y:et,z:o.to.z}))}static async blockLocationInRegionSync(e,n){return(await this.getAllRegionsSync()).find(o=>o.dimensionId==n&&Se(e,{x:o.from.x,y:Ze,z:o.from.z},{x:o.to.x,y:et,z:o.to.z}))}static async removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?a.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??Vt,this.key=i||Date.now().toString(),i||this.update().then(()=>{xe(),Q.push(this)})}async update(){return a.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}async delete(){let e=a.regions.get(this.key),n=new Kt(e.from.x,e.dimensionId=="minecraft:overworld"?-64:0,e.from.z),o=new Kt(e.to.x,e.dimensionId=="minecraft:overworld"?-64:0,e.to.z);for(let r of n.blocksBetween(o))h[e.dimensionId].getBlock(r)?.setType(Qn.bedrock);return Q=Q.filter(r=>r.key!=this.key),a.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Se(e.location,{x:this.from.x,y:Ze,z:this.from.z},{x:this.to.x,y:et,z:this.to.z})}changePermission(e,n){this.permissions[e]=n,this.update()}};var L=class{static getTasks(){return a.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return L.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=L.getTasks();o.push({playerName:e,role:n}),a.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as ge,MinecraftItemTypes as d}from"@minecraft/server";var Gt=[d.beehive.id,d.beeNest.id,d.axolotlBucket.id,d.codBucket.id,d.tadpoleBucket.id,d.tropicalFishBucket.id,d.salmonBucket.id,d.pufferfishBucket.id],Ut=[d.allow.id,d.barrier.id,d.borderBlock.id,d.debugStick?.id??"minecraft:debug_stick",d.deny.id,d.jigsaw.id,d.lightBlock.id,d.commandBlock.id,d.repeatingCommandBlock.id,d.chainCommandBlock.id,d.commandBlockMinecart.id,d.structureBlock.id,d.structureVoid.id,d.bedrock.id,d.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],Ht=[ge.dispenser.id],qt=[ge.bedrock.id,ge.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],Be=[ge.chest.id,ge.trappedChest.id],ui=[d.chest.id,d.trappedChest.id,d.barrel.id,d.dispenser.id,d.dropper.id,d.furnace.id,"minecraft:lit_furnace",d.blastFurnace.id,"minecraft:lit_blast_furnace",d.smoker.id,"minecraft:lit_smoker",d.hopper.id,d.shulkerBox.id,d.undyedShulkerBox.id],X={x:7,y:7,z:7};var Re={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var Wt="2.6.4-beta";var Ne="https://discord.gg/dMa3A5UYKX";function V(t,e=[],n){if(ye(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick @s \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function l(t){return t instanceof Xn?a.roles.get(t.name)??"member":a.roles.get(t)??"member"}function oe(t,e){if(typeof t=="string"){a.roles.set(t,e);let n=[...O.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new L(t,e)}else a.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ye(t){return O.getDynamicProperty("worldsOwner")==t.id}function nt(){let t=O.getDynamicProperty("worldsOwner");return!t||t==""?null:t}function Jt(){let t=nt();if(!t)return null;let e=a.ids.collection();return Object.keys(e).find(n=>e[n]===t)}function he(t){if(!t)return O.setDynamicProperty("worldsOwner","");O.setDynamicProperty("worldsOwner",t.id.toString())}function Me(){return O.getDynamicProperty("isLockDown")??!1}function ot(t){O.setDynamicProperty("isLockDown",t)}function xe(){for(let t of y.getAllRegions()){let e=new Qt(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new Qt(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))h[t.dimensionId].getBlock(o)?.setType(Jn.deny)}}var rt=[],Xt=0;function j(t,e=0){let n=Xt;return rt[n]={callback:t,delay:e,lastCall:0},Xt=n+1,n}function Zt(t){delete rt[t]}k.subscribe(()=>{tt.runSchedule(()=>{let t=[...O.getPlayers()];for(let[e,n]of t.entries())if(l(n)!="admin")for(let o of Object.values(rt))o.delay!=0&&tt.currentTick-o.lastCall<o.delay||(o.callback(n),e==t.length-1&&(o.lastCall=tt.currentTick))})});function I(t){switch(t){case"spam_config":return a.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};case"cbe_config":return a.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};case"gamemode_config":return a.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};case"nuker_data":return a.config.get("nuker_data")??{violationCount:0,banPlayer:!1};case"banned_items":return a.config.get("banned_items")??Ut;case"banned_blocks":return a.config.get("banned_blocks")??qt;case"enchantments":return a.config.get("enchantments")??Re;case"appealLink":return a.config.get("appealLink")??Ne}}function J(t,e){a.config.set(t,e)}function en(t){return I("enchantments")[t.type.id]??t.type.maxLevel}function tn(t){return Object.values(Zn).find(e=>[...O.getPlayers({name:t.name,gameMode:e})].length)}import{system as an}from"@minecraft/server";import{system as eo}from"@minecraft/server";var it={},nn={},Y={};function to(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),Y[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),Y[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(Y[t.id]?.changeType=="delete"&&Y[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),Y[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),Y[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),Y[t.id]=i}}return o}function no(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function oo(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:no(o),item:o}}return e}eo.runSchedule(()=>{for(let t of Object.values(it))for(let e of h.overworld.getEntities(t.entities)){let n=oo(e.getComponent("inventory").container),o=to(e,nn[e.id]??n,n);if(nn[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete Y[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var be=class{static subscribe(e,n){let o=Date.now();return it[o]={callback:n,entities:e},o}static unsubscribe(e){delete it[e]}};import{Location as ro}from"@minecraft/server";var B={},re={};function on(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function rn(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new ro(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function sn(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var De=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Pt(5),await e.show(this.gui.player)}};var ie=class{static spawnEntity(e){try{return e.dimension.spawnEntity(fe,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=ie.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.runScheduleId=an.runSchedule(()=>{if(!this.entity)return this.despawn();if(this.player.getComponent("mark_variant").value==1)this.hasChestOpen||(this.slotChangeEvent=be.subscribe({type:fe},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}},5)}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,v);if(!Object.keys(re).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=re[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,v);else if(e.changeType=="delete"){if(n.item&&rn(this.player,e.item),!n.item&&!sn(this.entity,e.slot))return;n.action(new De(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete B[this.player.name]}catch{}this.runScheduleId&&an.clearRunSchedule(this.runScheduleId),this.slotChangeEvent&&be.unsubscribe(this.slotChangeEvent)}};import{ItemStack as io}from"@minecraft/server";var w=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new io(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function mn(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,v);continue}o.setItem(r,i.item.itemStack)}}var K=class{constructor(e,n=mn){if(Object.keys(re).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],re[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as ln}from"@minecraft/server";var cs=new K("home").setSlots([22],new w(ln.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new w(ln.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});k.subscribe(()=>{cn.runSchedule(()=>{for(let t of so.getPlayers()){if(on(t)?.typeId!=zt){B[t.name]&&B[t.name].despawn();continue}Object.keys(B).includes(t?.name)||l(t)=="admin"&&(B[t.name]=new ie(t))}},10)});cn.runSchedule(()=>{let t=Object.values(B).map(e=>e.entity.id);for(let e of h.overworld.getEntities({type:fe}))t.includes(e.id)||e.triggerEvent("despawn")},100);import{system as ao}from"@minecraft/server";var ke={};k.subscribe(()=>{ao.run(()=>{for(let t of Object.values(ke))!t.getConfig().enabled||t.enable()})});var T={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"\xA7cYou've been temporarily muted in chat.","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var u=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new z(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,W.push(this)}argument(e){let n=new u(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new ce(e))}int(e){return this.argument(new ue(e))}array(e,n){return this.argument(new pe(e,n))}boolean(e){return this.argument(new de(e))}location(e){let n=this.argument(new q(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new u(e,new z(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as dn}from"@minecraft/server";function un(t,e,n,o="No Reason",r="Rubedo Auto Mod"){let i={key:e,playerName:t instanceof dn?t.name:t,date:Date.now(),duration:n?le(n):null,expire:n?le(n)+Date.now():null,reason:o,by:r};a.bans.set(e,i)}var P=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){e instanceof dn?un(e,e.id,n,o,r):un(e,a.ids.get(e),n,o,r)}};function st(t,e,n,o,r){if(a.bans.get(a.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),U(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new P(e,n,o,t.sender.name),t.reply(T["modules.commands.ban.reply"](e,n,o))})}var at=new u({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(l(t))});at.literal({name:"add",description:"Bans a player"}).argument(new g.playerName).executes((t,e)=>{st(t,e,null,null,t.sender.name)}).argument(new g.duration("duration")).executes((t,e,n)=>{st(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{st(t,e,n,o,t.sender.name)});at.literal({name:"remove",description:"un-bans a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);a.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to un-ban ${e}`)});at.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=a.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.ban.list.player"](n.playerName,n.reason,n.expire?ne(n.duration):"Forever"))});import{world as mo}from"@minecraft/server";function lo(t){!t||mo.say({rawtext:[{text:`
\xA72\xA7k===========================
\xA7r\xA77====== \xA7f[ \xA7c\xA7lBroadcast \xA7f] \xA77======
\xA7r\xA7o ${t}
\xA7r\xA72\xA7k===========================
`}]})}new u({name:"broadcast",description:"Broadcast System",aliases:["bc"],requires:t=>["admin","moderator"].includes(l(t))}).string("message").executes((t,e)=>{lo(e)});var Ie=new u({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>l(t)=="admin"});Ie.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=a[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});Ie.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{a[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});Ie.literal({name:"clear"}).string("table").executes((t,e)=>{try{a[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});Ie.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=a[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});Ie.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=a[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new u({name:"ecwipe",description:"Clears a players ender chest",requires:t=>l(t)=="admin"}).argument(new g.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`\xA7aCleared "${e.name}"'s Ender chest!`)});var Le=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};a.freezes.set(e.id,o)}};var mt=new u({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(l(t))});mt.literal({name:"add",description:"Freezes a player"}).argument(new g.player("player")).string("reason").executes((t,e,n)=>{new Le(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});mt.literal({name:"remove",description:"unfreezes a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);a.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});mt.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.freeze.list.player"](n.playerName,n.reason))});var lt=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(W.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function co(t,e,n){n.tell(`${S}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Oe(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&co(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Oe(t,r,e.depth==0?n:n.concat(e),o)}function pn(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${S}help <page: int>) ---`)}function ct(t){return W.filter(e=>e.depth==0&&e.data?.requires(t))}function fn(t){let e=ct(t);return e.length==0?0:Math.ceil(e.length/5)}var gn=new u({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=fn(t.sender),n=ct(t.sender).slice(1*5-5,1*5);pn(t.sender,1,e);for(let o of n)Oe(o,o,[],t.sender)});gn.int("page").executes((t,e)=>{let n=fn(t.sender);e>n&&(e=n);let o=ct(t.sender).slice(e*5-5,e*5);pn(t.sender,e,n);for(let r of o)Oe(r,r,[],t.sender)});gn.argument(new lt("command")).executes((t,e)=>{let n=W.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Oe(n,n,[],t.sender)});import{world as yn}from"@minecraft/server";new u({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>l(t)=="admin"}).executes(t=>{Me()?(ot(!1),t.sender.tell("\xA7aUnlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),U(t.sender,T["commands.lockdown.confirm"],()=>{ot(!0);for(let e of yn.getPlayers())l(e)!="admin"&&V(e,T["lockdown.kick.message"]());yn.say("\xA7l\xA7cServer is now LOCKED!")}))});var D=class{static getMuteData(e){return a.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?le(n):null,s={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};a.mutes.set(e.name,s)}};var ut=new u({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(l(t))});ut.literal({name:"add",description:"Mutes a player"}).argument(new g.player("player")).argument(new g.duration("duration")).string("reason").executes((t,e,n,o)=>{new D(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});ut.literal({name:"remove",description:"un-mutes a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);a.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});ut.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=a.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(T["commands.mutes.list.player"](n.playerName,n.reason,n.expire?ne(n.expire):"Forever"))});import{Location as uo}from"@minecraft/server";var se=class{static isValid(e){return e.typeId!="minecraft:npc"?!1:_e.find(n=>At(n,e.location))?!0:!!a.npcs.keys().find(n=>e.id==n)}constructor(e,n){_e.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};a.npcs.set(o.id,r),hn()}};new u({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>l(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new se(new uo(e,n,o),t.sender.dimension),t.reply("Spawned a verified npc at your current location")});import{system as bn}from"@minecraft/server";async function po(){let t=Date.now(),e=0;return new Promise(n=>{let o=bn.runSchedule(()=>{Date.now()-t<1e3?e++:(bn.clearRunSchedule(o),n(e))})})}new u({name:"ping",description:"Returns the current Ticks Per Second of the servers ping"}).executes(async t=>{let e=await po();t.reply(`\xA7aCurrent Ticks Per Second: ${e>18?"\xA7f{ \xA7aGood":e>13?"\xA7f{ \xA7eOk":"\xA7f{ \xA7cSevere"} ${e} \xA7f}`)});import{BlockLocation as we}from"@minecraft/server";var Ce=new u({name:"region",description:"Create a Region",requires:t=>l(t)=="admin"});Ce.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new y({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});Ce.literal({name:"remove",description:"Removes a region at the players current position"}).executes(t=>{let e=new we(t.sender.location.x,t.sender.location.y,t.sender.location.z);y.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});Ce.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{y.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});Ce.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=y.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var dt=Ce.literal({name:"permission",description:"Handles permissions for regions"});dt.literal({name:"set",description:"Sets a certain permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=y.blockLocationInRegion(new we(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permission ${e} to ${n}`)});dt.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=y.blockLocationInRegion(new we(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var kn=dt.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntities"});kn.literal({name:"add",description:"Adds a entity to the allowed entities list"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new we(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;o.push(e),n.changePermission("allowedEntities",o),t.reply(`Added entity ${e} to the allowed entities of the region your currently standing in`)});kn.literal({name:"remove",description:"Removes a entity from the allowed entities in the region"}).string("entity").executes((t,e)=>{let n=y.blockLocationInRegion(new we(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntities;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntities",o),t.reply(`Removed entity ${e} to the allowed entities of the region your currently standing in`)});var pt=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(pt||{});var fo=t=>isNaN(Number(t))===!1;function go(t){return Object.keys(t).filter(fo).map(e=>t[e])}var ft=new u({name:"role",description:"Changes the role for a player",requires:t=>l(t)=="admin"||ye(t)});ft.literal({name:"set",description:"Sets the role for a player"}).argument(new g.playerName("playerName")).argument(new g.array("role",go(pt))).executes((t,e,n)=>{oe(e,n),t.reply(`Changed role of ${e} to ${n}`)});ft.literal({name:"get",description:"Gets the role of a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=l(e);t.reply(`${e} has role: ${n}`)});var gt=ft.literal({name:"owner",description:"Manages the owner"});gt.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=nt(),n=a.ids.collection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});gt.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>ye(t)}).argument(new g.player).executes((t,e)=>{U(t.sender,`Are you sure you want to transfer the server ownership to ${e.name}, this action is not reversible!`,()=>{he(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)}),t.reply("\xA7aClose chat to confirm")});gt.literal({name:"clear",description:"clear's the owner of the world",requires:t=>ye(t)}).executes(t=>{U(t.sender,"Are you sure you want to clear the server owner, this action is not reversible!",()=>{he(null),t.reply('\xA7aCleared the server owner! run "/reload" or reload world to run "/function start" again!')}),t.reply("\xA7aClose chat to confirm")});import{ActionFormData as yo}from"@minecraft/server-ui";var _=class{constructor(e,n){this.title=e,this.body=n,this.form=new yo,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ModalFormData as ho}from"@minecraft/server-ui";var $e=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new Z("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var R=class{constructor(e){this.title=e,this.form=new ho,e&&this.form.title(e),this.args=[]}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}async show(e,n){for(let o=0;o<200;o++){let r=await this.form.show(e);if(r.cancelationReason!="userBusy"){n(new $e(this,e,n),...r.formValues.map((i,s)=>this.args[s].type=="dropdown"?this.args[s].options[i]:i));return}}return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)")}};function In(t){new _("Manage Banned Items").addButton("Remove a Banned Item",null,()=>{bo(t)}).addButton("Ban an item",null,()=>{ko(t)}).show(t)}function bo(t){new R("Remove Banned Items").addDropdown("Select item to remove",I("banned_items")).show(t,(e,n)=>{let o=I("banned_items");o=o.filter(r=>r!=n),J("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function ko(t){new R("Add Banned Item").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=I("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),J("banned_items",o),t.tell(`Banned the item "${n}"`)})}function wn(t){new _("Manage Banned Blocks").addButton("Remove a Banned Block",null,()=>{Io(t)}).addButton("Ban an block",null,()=>{wo(t)}).show(t)}function Io(t){new R("Remove Banned Block").addDropdown("Select block to remove",I("banned_blocks")).show(t,(e,n)=>{let o=I("banned_blocks");o=o.filter(r=>r!=n),J("banned_blocks",o),t.tell(`Removed Banned block "${n}"`)})}function wo(t){new R("Add Banned Block").addTextField("Block Id","minecraft:barrier").show(t,(e,n)=>{let o=I("banned_blocks");if(o.includes(n))return e.error(`\xA7cBlock "${n}" is already banned`);o.push(n),J("banned_blocks",o),t.tell(`Banned the block "${n}"`)})}function Cn(t){new R("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Re),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=I("enchantments");i[n]=r,J("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function vn(t){new R("Manage Appeal Link").addTextField("Appeal Link",Ne).show(t,(e,n)=>{J("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function En(t){let e=new _("Manage Protections");for(let n of Object.values(ke))e.addButton(n.name,n.iconPath,()=>{vo(n,t)});e.addButton("Back","textures/ui/arrow_dark_left_stretch.png",()=>{Fe(t)}).show(t)}function vo(t,e){let n=t.getConfig(),o=new R(`Manage ${t.name} Protection Config`).addToggle("Enabled",n.enabled),r=[];for(let[i,s]of Object.entries(t.configDefault))r.push(i),typeof s.defaultValue=="boolean"?o.addToggle(s.description,n[i]):typeof s.defaultValue=="number"?o.addSlider(s.description,0,100,1,n[i]):o.addTextField(s.description,null,n[i]);o.show(e,(i,s,...m)=>{s!=n.enabled&&(s&&t.enable(),s||t.disable());let c={enabled:s};for(let[p,f]of Object.keys(t.configDefault).entries())c[f]=m[p];t.setConfig(c),e.tell(`Updated config for ${t.name}!`)})}function Fe(t){new _("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{En(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{In(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{wn(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{Cn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{vn(t)}).show(t)}new u({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(l(t))}).executes(t=>{Fe(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as Sn}from"@minecraft/server";function Tn(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode s"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;Sn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;Sn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new u({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>l(t)=="admin"}).executes(t=>{Tn(t.sender,!1)}).boolean("say").executes((t,e)=>{Tn(t.sender,e)});new u({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current BotWea AC Version: ${Wt}`)});new u({name:"kick",description:"Kicks a player from the game",requires:t=>["admin","moderator"].includes(l(t))}).argument(new g.player).string("reason").executes((t,e,n)=>{V(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var $=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),a.logs.set(Date.now().toString(),e)}};function yt(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,s=Date.now()-t;return s<e?Math.round(s/1e3)+" seconds ago":s<n?Math.round(s/e)+" minutes ago":s<o?Math.round(s/n)+" hours ago":s<r?"approximately "+Math.round(s/o)+" days ago":s<i?"approximately "+Math.round(s/r)+" months ago":"approximately "+Math.round(s/i)+" years ago"}var ve=new u({name:"log",description:"Manages the log command",requires:t=>l(t)=="admin"});ve.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new $({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});ve.literal({name:"getAll",description:"Gets all logs sorted in descending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(a.logs.collection()).sort((i,s)=>n=="ascending"?parseInt(s[0])-parseInt(i[0]):parseInt(i[0])-parseInt(s[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${S}log getAll <page: int>) ---`);for(let[i,s]of o.slice(e*8-8,e*8))t.reply(`${yt(parseInt(i))}: ${s.message}`)});ve.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new g.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].playerName==e).sort((s,m)=>o=="ascending"?parseInt(m[0])-parseInt(s[0]):parseInt(s[0])-parseInt(m[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[s,m]of r.slice(n*8-8,n*8))t.reply(`${yt(parseInt(s))}: ${m.message}`)});ve.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(a.logs.collection()).filter(s=>s[1].protection==e).sort((s,m)=>o=="ascending"?parseInt(m[0])-parseInt(s[0]):parseInt(s[0])-parseInt(m[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[s,m]of r.slice(n*8-8,n*8))t.reply(`${yt(parseInt(s))}: ${m.message}`)});ve.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{a.logs.clear(),t.reply("\xA7aCleared All logs!")});var So=new u({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>l(t)=="admin"});So.argument(new g.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});j(t=>{try{let e=a.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return a.bans.delete(t.id);V(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?ne(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${I("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),a.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as To}from"@minecraft/server";j(t=>{try{let e=a.freezes.get(t.id);if(!e)return t.getComponent("movement").resetToDefaultValue();t.getComponent("movement").setCurrent(0),t.teleport(new To(e.location.x,e.location.y,e.location.z),h[e.location.dimension],0,0)}catch{}},200);import{world as Po}from"@minecraft/server";var ht={};Po.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(S))for(let e of Object.values(ht))e.callback(t)});var ze=class{static subscribe(e){let n=Date.now();return ht[n]={callback:e},n}static unsubscribe(e){delete ht[e]}};ze.subscribe(t=>{let e=D.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return a.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(T["modules.managers.mute.isMuted"]())}});import{BlockLocation as Ao,system as Pn,world as bt}from"@minecraft/server";Pn.runSchedule(()=>{xe()},6e3);bt.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(l(t.source)))return;let e=y.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);jt.includes(n.typeId)&&e.permissions.doorsAndSwitches||Yt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});bt.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(y.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});bt.events.entityCreate.subscribe(async({entity:t})=>{let e=await y.blockLocationInRegionSync(new Ao(t.location.x,t.location.y,t.location.z),t.dimension.id);!e||e.permissions.allowedEntities.includes(t.typeId)||(t.teleport({x:0,y:-64,z:0},t.dimension,0,0),t.kill())});k.subscribe(()=>{Pn.runSchedule(async()=>{for(let t of await y.getAllRegionsSync())for(let e of h[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntities}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100)});j(t=>{for(let e of y.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as xo}from"@minecraft/server";xo.events.playerJoin.subscribe(async({player:t})=>{if(await k.awaitLoad(),Me()&&l(t)!="admin")return V(t,T["lockdown.kick.message"]());D.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),a.ids.has(t.name)?t.addTag("old"):a.ids.set(t.name,t.id);let e=L.getPlayersRoleToSet(t.name);e&&oe(t,e)});import{Items as Bo,MinecraftItemTypes as F,world as kt}from"@minecraft/server";var An=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],Ro=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function No(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,v);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...kt.getPlayers()].entries()){let s=An[r],m=new w(F.skull,{nameTag:i.name,data:3});o.setItem(s,m.itemStack),e.slots[s]={item:m,action:c=>{c.PageAction("moderation:see_inventory",{name:i.name})}}}}function Mo(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let c=0;c<o.size;c++){let p=e.slots[c];if(!p||!p.item){o.setItem(c,v);continue}o.setItem(c,p.item.itemStack)}let r=new w(F.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:c=>{c.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...kt.getPlayers()].find(c=>c.name==n.name);i||(Object.values(B).find(p=>p.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let s=i.getComponent("inventory").container,m=0;for(let c=0;c<s.size;c++){let p=s.getItem(c),f=An[m];if(m++,!p){o.setItem(f,v);continue}o.setItem(f,p),e.slots[f]={item:new w(Bo.get(p.typeId),{amount:p.amount,data:p.data},p),action:x=>{c<9?i.runCommandAsync(`replaceitem entity @s slot.hotbar ${c} air`):i.runCommandAsync(`replaceitem entity @s slot.inventory ${c-9} air`),x.GiveAction(),e.slots[f]={item:null,action:N=>{s.addItem(N.getItemAdded())}}}}}}async function Do(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let m=0;m<o.size;m++){let c=e.slots[m];if(!c||!c.item){o.setItem(m,v);continue}o.setItem(m,c.item.itemStack)}let r=[...kt.getPlayers()].find(m=>m.name==n?.name);r||(Object.values(B).find(c=>c.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,s=Object.values(F);for(let m of s)try{await r.runCommandAsync(`testfor @s[hasitem={item=${m.id},location=slot.enderchest}]`);let c=new w(m,{nameTag:"Note: \xA7l\xA7cThis is not the exact item"}),p=Ro[i];o.setItem(p,c.itemStack),e.slots[p]={item:c,action:f=>{f.GiveAction(),e.slots[p]=null}},i++}catch{}}new K("moderation:see",No).setSlots([50],new w(F.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new w(F.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new K("moderation:see_inventory",Mo).setSlots([50],new w(F.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new w(F.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new K("moderation:see_ender_chest",Do).setSlots([50],new w(F.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new w(F.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{Player as Lo,MinecraftBlockTypes as Oo}from"@minecraft/server";import{system as xn,world as Bn}from"@minecraft/server";var C=class{constructor(e,n,o,r){this.name=e;this.description=n;this.iconPath=o;this.isEnabledByDefault=r;this.name=e,this.description=n,this.iconPath=o,this.configDefault={},this.isEnabled=!1,this.isEnabledByDefault=r,this.events={},this.schedules=[],this.forEachValidPlayers=[],ke[this.name]=this}setConfigDefault(e){return this.configDefault=e,a.protections.hasSync(this.name).then(n=>{if(n)return;let o={enabled:!0};for(let r of Object.keys(e))o[r]=e[r].defaultValue;a.protections.set(this.name,o)}),this}getConfig(){let e=a.protections.get(this.name);return e||(e={enabled:this.isEnabled}),e}async setConfig(e){return a.protections.set(this.name,e)}triggerChange(e){if(e){this.isEnabled=!0,this.onEnableCallback?.();for(let[n,o]of Object.entries(this.events)){if(o.triggered)continue;let r=Bn.events[n].subscribe(o.callback);o.triggered=!0,o.callback=r}for(let n of this.forEachValidPlayers){if(n.key)continue;let o=j(n.callback,n.delay);n.key=o}for(let n of this.schedules){if(n.runScheduleId)continue;let o=xn.runSchedule(n.callback);n.runScheduleId=o}}else{this.isEnabled=!1,this.onDisableCallback?.();for(let[n,o]of Object.entries(this.events))!o.triggered||(Bn.events[n].unsubscribe(o.callback),o.triggered=!1);for(let n of this.forEachValidPlayers)!n.key||(Zt(n.key),n.key=null);for(let n of this.schedules)!n.runScheduleId||(xn.clearRunSchedule(n.runScheduleId),n.runScheduleId=null)}}onEnable(e){return this.onEnableCallback=e,this}onDisable(e){return this.onDisableCallback=e,this}subscribe(e,n){return this.events[e]={callback:n,triggered:!1},this}runSchedule(e,n){return this.schedules.push({callback:e,tickInterval:n,runScheduleId:null}),this}forEachValidPlayer(e,n=0){return this.forEachValidPlayers.push({callback:e,delay:n,key:null}),this}enable(){this.triggerChange(!0)}disable(){this.triggerChange(!1)}};var _o=["minecraft:command_block_minecart"],Ve=new C("cbe","Stops CBE","textures/blocks/command_block.png",!0).setConfigDefault({entityCreate:{description:"Adds NPC protection",defaultValue:!0},banSpawnEggs:{description:"If spawn eggs should be banned",defaultValue:!0}});Ve.subscribe("entityCreate",({entity:t})=>{if(!Ve.getConfig().entityCreate)return;let n=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(_o.includes(t.typeId)||t.typeId=="minecraft:npc"&&!se.isValid(t))return n()});Ve.subscribe("beforeItemUseOn",t=>{if(!(t.source instanceof Lo)||["admin","moderator"].includes(l(t.source)))return;let e=Ve.getConfig();if(t.item.typeId.endsWith("spawn_egg")){if(!e.banSpawnEggs||t.source.dimension.getBlock(t.blockLocation).typeId==Oo.mobSpawner.id)return;t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass")}else{if(Ht.includes(t.item.typeId)){t.cancel=!0;return}if(!I("banned_blocks").includes(t.item.typeId))return;t.cancel=!0,new P(t.source,null,"Placing Banned Blocks")}});var It=32e4;new C("crasher","Protection against type 1 crasher","textures/ui/servers.png",!0).forEachValidPlayer(t=>{(Math.abs(t.location.x)>It||Math.abs(t.location.y)>It||Math.abs(t.location.z)>It)&&new P(t,null,"Crasher detected")});import{GameMode as Fo,world as zo}from"@minecraft/server";import{world as $o}from"@minecraft/server";var A=class{constructor(){this.data=new Map,this.events={playerLeave:$o.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var Vo=Fo.creative,Rn=new A,Nn=new C("gamemode","Blocks illegal gamemode","textures/ui/creative_icon.png",!0).setConfigDefault({clearPlayer:{description:"Whether to clear players inventory.",defaultValue:!0},setToSurvival:{description:"If player should be set to survival after being flagged.",defaultValue:!0},banPlayer:{description:"If player should be banned after violation count is met.",defaultValue:!1},violationCount:{description:"The amount of violations before ban.",defaultValue:0}});Nn.runSchedule(()=>{let t=Nn.getConfig();for(let e of zo.getPlayers({gameMode:Vo})){if(["moderator","admin","builder"].includes(l(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}new $({playerName:e.name,protection:"Gamemode",message:`${e.name} has entered into a illegal gamemode!`});let n=(Rn.get(e)??0)+1;Rn.set(e,n),t.banPlayer&&n>=t.violationCount&&new P(e,null,"Illegal Gamemode")}},20);import{world as Ko,Location as Go,system as Uo}from"@minecraft/server";import{system as jo,world as Yo}from"@minecraft/server";var je=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ye={};jo.runSchedule(()=>{Ye={};for(let t of Yo.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=Tt(t.location),n=e.offset(X.x,X.y,X.z),o=e.offset(-X.x,-X.y,-X.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Be.includes(i.typeId)||(Ye[JSON.stringify(r)]=new je(i.getComponent("inventory").container))}}},100);var wt={};Ko.events.blockBreak.subscribe(t=>{for(let e of Object.values(wt))e.callback(new Ct(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Ee=class{static subscribe(e){let n=Date.now();return wt[n]={callback:e},n}static unsubscribe(e){delete wt[e]}},Ct=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Be.includes(this.brokenBlockPermutation.type.id)){let n=Ye[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}Uo.run(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new Go(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())})}};var Mn=new A,Ho=15,qo=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],Wo=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],Dn=new A,Ln=null,On=new C("nuker","Blocks block breaking too fast","textures/blocks/dirt.png",!0).setConfigDefault({banPlayer:{description:"If the player should be banned once violation count is met",defaultValue:!1},violationCount:{description:"Violations before ban",defaultValue:0}});On.onEnable(()=>{let t=On.getConfig();Ln=Ee.subscribe(e=>{if(["moderator","admin"].includes(l(e.player))||e.block.getTags().some(o=>qo.includes(o)))return;let n=Mn.get(e.player);if(Mn.set(e.player,Date.now()),!!n){if(!Wo.includes(e.block.typeId)){if(n<Date.now()-Ho)return;let o=(Dn.get(e.player)??0)+1;Dn.set(e.player,o),t.banPlayer&&o>=t.violationCount&&new P(e.player,null,"Using Nuker")}e.cancel=!0}})}).onDisable(()=>{Ee.unsubscribe(Ln)});var _n=new A,$n=new A,Fn=new C("spam","Blocks spam in chat","textures/ui/mute_on.png",!0).setConfigDefault({permMutePlayer:{description:"If player should be permanently muted once violation count is met.",defaultValue:!1},violationCount:{description:"Violation count before permanent mute",defaultValue:0},repeatedMessages:{description:"Blocks repeated messages",defaultValue:!0},zalgo:{description:"Blocks zalgo",defaultValue:!0}});Fn.subscribe("beforeChat",t=>{try{if(t.message.startsWith(S)||["admin","moderator"].includes(l(t.sender)))return;let e=Fn.getConfig(),n=()=>{let o=($n.get(t.sender)??0)+1;$n.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new D(t.sender,null,"Spamming")};if(e.repeatedMessages&&_n.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");_n.set(t.sender,t.message)}catch(e){console.warn(e+e.stack)}});var zn=new A;function Ke(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=I("cbe_config");if(r.clearItem&&n.setItem(e,v),new $({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(zn.get(t)??0)+1;zn.set(t,i),!(i<r.violationCount)&&new P(t,null,"Possession of Unobtainable item")}new C("unobtainable","Blocks unobtainable items","textures/blocks/end_portal.png",!0).forEachValidPlayer(t=>{console.warn("unobtainable");let e=I("banned_items"),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.includes(r.typeId))return Ke(t,o);if(Gt.includes(r.typeId))return new $({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,v);let i=[];for(let s of r.getComponent("enchantments").enchantments){let m=en(s);if(s.level>m||s.level<1||i.includes(s.type.id))return Ke(t,o);i.push(s.type.id)}}});import{MinecraftBlockTypes as E,MinecraftEntityTypes as Qo,MinecraftItemTypes as G,Player as Xo}from"@minecraft/server";var Jo=[E.chest.id,E.trappedChest.id,E.barrel.id,E.dispenser.id,E.dropper.id,E.furnace.id,E.litFurnace.id,E.blastFurnace.id,E.litBlastFurnace.id,E.smoker.id,E.litSmoker.id,E.hopper.id,E.beehive.id,E.beeNest.id,E.mobSpawner.id],Zo=[G.chestBoat.id,G.oakChestBoat.id,G.birchChestBoat.id,G.acaciaChestBoat.id,G.jungleChestBoat.id,G.spruceChestBoat.id,G.darkOakChestBoat.id,G.mangroveChestBoat.id];new C("nbt","Blocks illegal nbt on items","textures/ui/icon_random.png",!0).subscribe("blockPlace",async({block:t})=>{if(!Jo.includes(t.typeId))return;let e=t.permutation;await t.dimension.runCommandAsync(`setblock ${t.x} ${t.y} ${t.z} ${t.typeId}`),t.setPermutation(e)}).subscribe("beforeItemUseOn",t=>{t.source instanceof Xo&&(!Zo.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(Qo.chestBoat.id,t.blockLocation.above()),tn(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,v)))});import{MinecraftEffectTypes as er,Player as tr,world as Vn}from"@minecraft/server";var nr=Vn.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(!(t.entity instanceof tr)||t.id!="rubedo:becomeAdmin")return;t.entity.removeTag("CHECK_PACK");let e=Jt();if(e)return t.entity.playSound("note.bass"),t.entity.tell(`\xA7cFailed to give server owner: "${e}" is already owner!`),Vn.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(nr);oe(t.entity,"admin"),he(t.entity),t.entity.addEffect(er.blindness,3,255,!0),t.entity.tell('\xA7aYou have now been set as the "owner" of this server. The command "/function start" will not do anything anymore, type "-help" for more information!')});import{DynamicPropertiesDefinition as Yn,MinecraftEntityTypes as or,world as Kn}from"@minecraft/server";var jn=[];Kn.events.worldInitialize.subscribe(({propertyRegistry:t})=>{let e=new Yn;e.defineString("role",30),t.registerEntityTypeDynamicProperties(e,or.player);let n=new Yn;n.defineString("worldsOwner",100),n.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(n);for(let o of jn)Kn.scoreboard.addObjective(o.objective,o.displayName??"")});var _e=[];function hn(){_e=[]}console.warn("----- Importing Plugins -----");import{DynamicPropertiesDefinition as rr,EntityTypes as ir,world as sr}from"@minecraft/server";sr.events.worldInitialize.subscribe(({propertyRegistry:t})=>{h.overworld.runCommandAsync(`tickingarea add ${M.x} ${M.y} ${M.z} ${M.x} ${M.y} ${M.z} db true`);let e=new rr;e.defineString("tableName",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,ir.get(ae))});console.warn("---- STARTING RUBEDO ----");lr.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});var v=new ar(mr.stick,0);export{v as AIR};
//# sourceMappingURL=index.js.map
